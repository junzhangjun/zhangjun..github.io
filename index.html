<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
<!-- 		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"> -->
        <!--<meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="yes" name="apple-touch-fullscreen">
        <meta content="telephone=no,email=no" name="format-detection">
        <script src="http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js"></script>
        <link rel="apple-touch-icon" href="favicon.png">
        <link rel="Shortcut Icon" href="favicon.png" type="image/x-icon">
    	<script src="build/flexible_css.debug.js"></script>
		<script src="build/flexible.debug.js"></script>-->
		<title></title>
		
		<style>
			ul,li,div,body{ list-style: none; margin: 0; padding: 0;}
			.showBox{ width: 100%; position: relative; overflow: hidden; }
			.ulBox{ width: 100%;position: absolute;}
			.ulBox ul{ width: 100%; overflow: hidden;}
			.ulBox ul li{ width: 25%;  border: 1px solid black; box-sizing: border-box; float: left; color: white; text-align: center;}
			.showBox .time{ position: absolute; top: 0; width: 100%; text-align: center; z-index: 1; color: red; line-height: 50px; font-size: 30px; font-weight: bold;}
			.gameOver{color: white; width: 100%; height: 100%; position: absolute; z-index: 2; display: none; background-color: rgba(255,0,0,0.8); left: -400px;}
			.gameOver .message{text-align: center; position: absolute; top: 30%; width: 100%; }
			.gameOver .message p{padding: 0 50px;}
			.gameOver .message p:nth-child(1){ font-size: 28px;}
			.gameOver .btn div{ float: left; width: 50%; text-align: center;font-size: 24px;}
			.gameOver .btn{position: absolute; top: 600px; overflow: hidden; text-align: center; width: 300px; margin: 0 50px;}
			.input{ position: absolute; z-index: 3; width: 200px; padding:20px; background-color: cadetblue; left: 50%; margin-left: -120px; top: 35%; box-shadow: 0px 0px 10px gray; display: none;}
			.input p{ font-size: 12px; padding: 0 ; margin:10px 0; color: white;}
			.input input{ border: none; width: 100%; line-height: 20px; margin-bottom: 10px;}
			.input .submit{width: 100px; text-align: center; margin-left: 50px; border: 1px solid white; border-radius: 20px; line-height: 30px; color: white;}
		</style>
	</head>
	
	
	<body>
		<div class="showBox">
			<div class="time"></div>
			<div class="ulBox">
				<ul><li></li><li></li><li></li><li></li></ul>
				<ul><li></li><li></li><li></li><li></li></ul>
				<ul><li></li><li></li><li></li><li></li></ul>
				<ul><li></li><li></li><li></li><li></li></ul>
				<ul><li></li><li></li><li></li><li></li></ul>
				<ul><li></li><li></li><li></li><li></li></ul>
			</div>		
			<div class="gameOver">
				<div class="message">
					<h1>游戏结束</h1>
					<p></p>
					<p></p>
					<p></p>
					
				</div>
				<div class="btn">
					<div class="share">分享</div>
					<div class="rePlay">重来</div>
				</div>
			</div>
			<div class="input">
				<p>您好，恭喜您获得游戏胜利优惠券，请输入手机号领取吧</p>
				<input type="tel" />
				<div class="submit">提交</div>
			</div>
		</div>

	</body>
	<script src="fastclick.js"></script>
	<script src="move2.js"></script>
	<script>
		
		window.addEventListener('load', function () {
			FastClick.attach(document.body);
		}, false);

		var height=screen.height/4;
		window.onload=function(){
			
			document.getElementsByClassName("showBox")[0].style.height=4*height+"px";
			document.getElementsByClassName("ulBox")[0].style.height=6*height+"px";
			document.getElementsByClassName("ulBox")[0].style.bottom=-1*height+"px"
			var lis=document.getElementsByTagName("li");
			for(i=0;i<lis.length;i++){
				lis[i].style.height=height+"px";
				lis[i].style.lineHeight=height+"px";
			}
			reset();
			document.getElementsByClassName("rePlay")[0].onclick=reset;
		}
		
		var num=0;
		var timer=null;
		var nowT=30.00;
		function reset(){
			//重置样式
			num=0;
			timer=null;
			document.getElementsByClassName("gameOver")[0].style.display="none";
			document.getElementsByClassName("gameOver")[0].style.left="-500px";
			document.getElementsByClassName("input")[0].style.display="none";
			var lis=document.getElementsByTagName("li");
			for(i=0;i<lis.length;i++){
				lis[i].style.backgroundColor="white";
			};	
			document.getElementsByClassName("time")[0].innerHTML="30.00''";
			//设置黑色块
			var uls=document.getElementsByTagName("ul");
			var fLis=document.getElementsByTagName("ul")[4].getElementsByTagName("li");
			for(i=0;i<fLis.length;i++){
				fLis[i].style.backgroundColor="chocolate"
			}
			for(i=0;i<uls.length;i++){
				if(i==4){					
					continue;
				}
				var lis=uls[i].getElementsByTagName("li");
				for(a=0;a<lis.length;a++){
					lis[a].index=0;
				};
				var m=getRandom();
				lis[m].index=1;
				lis[m].style.backgroundColor="#000000";	
				if(i==3){
					
					uls[i].getElementsByTagName("li")[m].innerHTML="start";
					
					removeF();
				}				
			};	
		};
		
		function getRandom(){
			var i;
			i=parseInt(4*Math.random());
			return i;
		};
		
		function setIndex(uls){
			var lis=uls.getElementsByTagName("li");
			for(a=0;a<lis.length;a++){
				lis[a].index=0;
			}
			var m=getRandom();
			lis[m].index=1;
			lis[m].style.backgroundColor="#000000";
			return m;
		}
		
		function removeF(){
			//移除事件
			var lis=document.getElementsByTagName("li");
			for(i=0;i<lis.length;i++){
				lis[i].onclick=null;
			}			
			//设置事件
			var lis3=document.getElementsByTagName("ul")[3].getElementsByTagName("li");
			for(i=0;i<lis3.length;i++){
				lis3[i].onclick=click;
			}
		};
		
		
		function click(){
			if(this.index==1){
				num++;
				if(this.innerHTML=="start"){
					this.innerHTML="";
					nowT=30.00;
					timer=setInterval(function(){
						nowT=nowT-0.01;
						nowT=nowT.toFixed(2);
						if(nowT==25){
							clearInterval(timer);
							nowT=30;
							gameOver(num);
							
						}
						document.getElementsByClassName("time")[0].innerHTML=nowT+"''";
					},10);
						
				}
				this.style.backgroundColor="gray";
				
				var div=document.getElementsByClassName("ulBox")[0];
				var ul=document.getElementsByTagName("ul")[5];
				startMove(div,{bottom:-2*height},function(){
					newUl();					
				});
				
			}else{		
				this.innerHTML=""
				clearInterval(timer);
				nowT=30;
				this.style.backgroundColor="red";
				num=0;
				gameOver(num);
			};
		};
		
		function newUl(){
			//移除最底部ul
			var div=document.getElementsByClassName("ulBox")[0];
			var ul=document.getElementsByTagName("ul")[5];
			var ul1=div.getElementsByTagName("ul")[0];
			div.removeChild(ul);
			div.style.bottom=-1*height+"px";
			//添加newUl；			
			var uls=document.getElementsByTagName("ul");			
			var newUls=document.createElement("ul");
			for(i=0;i<4;i++){
				var newLi=document.createElement("li");
				newUls.appendChild(newLi);
			};
			
			div.insertBefore(newUls,div.firstChild);
			document.getElementsByClassName("ulBox")[0].style.bottom=-1*height+"px";
			var lis=document.getElementsByTagName("li");
			for(i=0;i<lis.length;i++){
				lis[i].style.height=height+"px";
			}
			setIndex(newUls);
			removeF();
		};
		
		function removeF(){
			//移除事件
			var lis=document.getElementsByTagName("li");
			for(i=0;i<lis.length;i++){
				lis[i].onclick=null;
			}			
			//设置事件
			var lis3=document.getElementsByTagName("ul")[3].getElementsByTagName("li");
			for(i=0;i<lis3.length;i++){
				lis3[i].onclick=click;
			};
		};
		
		function gameOver(num){
			alert(num);
			var message=document.getElementsByClassName("gameOver")[0].getElementsByClassName("message")[0];
			if(num>=0 && num<5){
				document.getElementsByClassName("gameOver")[0].style.display="block";
				document.getElementsByClassName("gameOver")[0].style.backgroundColor='red';
				if(num==0){
					message.getElementsByTagName("p")[2].innerHTML="很遗憾，您闯关失败了，请再接再厉获取游戏奖励哦";
				}else{
					document.getElementsByClassName("gameOver")[0].style.display="block";
					document.getElementsByClassName("gameOver")[0].style.backgroundColor='red';
					message.getElementsByTagName("p")[0].innerHTML="您的得分";
					message.getElementsByTagName("p")[0].style.fontSize="26px"
					message.getElementsByTagName("p")[1].innerHTML=num;
					message.getElementsByTagName("p")[1].style.fontSize="30px";
					message.getElementsByTagName("p")[1].style.fontWeight="bold";
					message.getElementsByTagName("p")[2].innerHTML="很遗憾，您的得分为达到领奖标准哦，请再接再厉";
				}
				
			}else if(num>=5){
				document.getElementsByClassName("rePlay")[0].onclick=null;
				document.getElementsByClassName("gameOver")[0].style.display="block";
				document.getElementsByClassName("gameOver")[0].style.backgroundColor='green';
				message.getElementsByTagName("p")[0].innerHTML="您的得分";
				message.getElementsByTagName("p")[0].style.fontSize="26px"
				message.getElementsByTagName("p")[1].innerHTML=num;
				message.getElementsByTagName("p")[1].style.fontSize="30px";
				message.getElementsByTagName("p")[1].style.fontWeight="bold";
				message.getElementsByTagName("p")[2].innerHTML="恭喜您，挑战成功，输入手机号领取优惠券吧！";
				setInterval(function(){
					document.getElementsByClassName("input")[0].style.display="block";
				},2000);
				num=0;
			}
			
			var t=setTimeout(function(){
				var div=document.getElementsByClassName("gameOver")[0];
				startMove(div,{left:0});
				},600);
		}
		
		function getStyle(obj, name)
		{
			if(obj.currentStyle)
			{
				return obj.currentStyle[name];
			}
			else
			{
				return getComputedStyle(obj, false)[name];
			}
		}


		//startMove(oDiv, {width: 400, height: 400})


		function startMove(obj, json, fnEnd)
		{
			clearInterval(obj.timer);
			obj.timer=setInterval(function (){
				var bStop=true;		//假设：所有值都已经到了

				for(var attr in json)
				{
					var cur=0;

					if(attr=='opacity')
					{
						cur=Math.round(parseFloat(getStyle(obj, attr))*100);
					}
					else
					{
						cur=parseInt(getStyle(obj, attr));
					}

					var speed=(json[attr]-cur)/3;
					speed=speed>0?Math.ceil(speed):Math.floor(speed);

					if(cur!=json[attr])
						bStop=false;

					if(attr=='opacity')
					{
						obj.style.filter='alpha(opacity:'+(cur+speed)+')';
						obj.style.opacity=(cur+speed)/100;
					}
					else
					{
						obj.style[attr]=cur+speed+'px';
					}
				}

				if(bStop)
				{
					clearInterval(obj.timer);

					if(fnEnd)fnEnd();
				}
			}, 0.01);
		}
	</script>
</html>
